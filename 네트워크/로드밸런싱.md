### 로드 밸런싱

:heavy_check_mark: 개념

- 웹 사이트에 접속 인원이 굉장히 많으면 모든 트래픽을 감당하기에 1대의 서버로는 부족

- 대응 방안 

  - 하드웨어의 성능 올리기(Scale-up)
    - 향상 비용 비쌈
  - 여러 대의 서버가 나눠서 일하도록 만든다(Scale-out)
    - 서버가 여러대면 **무중단 서비스를 제공**하는 환경 구성이 용이

- **여러 서버에게 균등하게 트래픽을 분산** = `로드 밸런싱`

- `분산식 웹 서비스`로, 로드밸런서를 클라이언트와 서버 사이에 두고 부하가 일어나지 않도록 여러 서버에 분산

- 둘 혹은 셋 이상의 중앙처리장치 혹은 저장장치와 같은 컴퓨터 자원들에게 작업을 나눔

  ![image](https://user-images.githubusercontent.com/43842108/218710551-f73fbfe5-5e02-48b8-840e-ac2692295c45.png)

<br>

:heavy_check_mark: 로드 밸런싱 알고리즘

1. 라운드 로빈

   - 시분할 시스템을 위해 설계된 스케쥴링 방식 중 하나

     - cf) 시분할 시스템 = cpu가 각 프로그램을 일정 시간동안 번갈아 가면서 실행

   - 프로세스들 사이에 우선순위를 두지 않고, **`순서대로` 일정 시간동안 cpu를 할당**하는 방식

   - 여러 개의 자원이 동일한 성능(스펙)이고, 서버와의 연결(세션)이 오래 지속되지 않을 경우에 적합

     <br>

2. 가중 라운드로빈 방식(Weighted)

   - 각각의 서버마다 가중치를 매기고 **가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분**

   - 주로 서버의 **트래픽 처리 능력이 상이한 경우 사용**되는 부하 분산 방식

   - EX

     - A 서버 = 5가중치, B서버=2가중치이면 => A서버에 5개, B서버에 2개의 요청 전달

     <br>

3. Least Connections(최소 연결)

   - **연결 개수가 가장 적은 서버를 선택**

   - 트래픽으로 세션이 길어지는 경우 권장

   - 서버에 트래픽을 분배하는 것이 일정하지 않을 때 적합

     <br>

4. IP 해시 방식 (=Source)

   - **클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리**하는 방식

   - 사용자의 IP를 해싱해 로드를 분배하기 때문에 **사용자가 항상 동일한 서버로 연결되는 것을 보장**

     - cf) 해싱 = 임의의 길이를 지닌 데이터를 고정된 길이의 데이터로 매핑

       <br>

5. 최소 리스폰 타임

   - **서버의 현재 연결 상태와 응답 시간을 고려하여 트래픽을 배분**하는 방식
     - cf) 응답 시간 = 서버에 요청을 보내고 최초 응답을 받을 때까지 소요되는 시간
   - 가장 적은 연결 상태와 가장 짧은 응답시간을 보이는 서버에 우선적으로 로드 배분

   <br>

:heavy_check_mark: 이점

- 다운 타임 감소
  - 다운 타임 = 시스템을 이용할 수 없는 시간
- 확장 가능
- 중복성
- 유연성
- 효율

<br>

:heavy_check_mark: 종류

1. 운영체제 로드밸런서

   - 물리적 프로세서 간에 작업을 스케쥴링

   <br>

2. 네트워크 로드밸런서

   - 사용 가능한 백엔드에서 네트워크 작업을 스케쥴링

     <br>

     1. L2(Data Link Layer)

        - **Mac 주소를 바탕**으로 로드 밸런싱

        - 장점

          - 구조 간단, 신뢰성 높음, 가격 저렴, 성능 좋음

        - 단점

          - Broadcast 패킷에 의해 성능 저하 발생, 라우팅 등 상위 레이어 프로토콜 기반 스위칭 불가

          <br>

     2. L3(Network Layer)

        - **IP주소를 바탕**으로 로드 밸런싱

        - 장점

          - Broadcast 트래픽으로 전체 성능 저하 방지, 트래픽 체크

        - 단점

          - 특정 프로토콜을 이용해야 스위칭 가능

          <br>

     3. L4(Transport Layer)

        - **Transport Layer(IP와 port) 바탕**으로 로드 밸런싱
        - TCP, UDP 프로토콜
        - 장점
          - Port 기반 스위칭 지원, VIP를 이용하여 여러 대를 한대로 묶어 부하 분산
        - 주로 라운드 로빈 방식 사용

        <br>

     4. L7(Application Layer)

        - **Application Layer(사용자의 Request) 레벨**에서 로드 밸런싱
        - HTTP, HTTPS, FTP 프로토콜

     <br>

     :ballot_box_with_check: L4와 L7의 차이

     - 일반적으로 로드밸런서는 크게 L4와 L7 사용

     <br>

     - 공통점

       - 들어온 packet을 적절한 목적지로 전달(스위칭)
       - 적절한 알고리즘을 통해 로드밸런서로서의 역할 수행
       - 스위치 및 서버별 Health Check

     - 차이점

       - L4는 단지 부하를 분산시키는 것이라면, L7은 요청의 세부적인 사항을 두고 결제만 담당하는 서버, 회원가입을 담당하는 서버 등으로 분리해 가볍고 작은 단위로 여러 개의 서비스를 운영하고 요청을 각각의 서버에 분산
       - L7은 L4와 다르게 데이터를 분석해 처리가 가능하기 때문에 악의적이거나 비정상적인 콘텐츠를 감지해 보안 지점을 구축할 수 있는 장점과 그만큼 자원 소모가 크다는 단점

       
